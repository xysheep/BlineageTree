
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Grow Lineages along Minimum Spanning Tree for B Cell Recptor Seqeuence Data</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-01-31"><meta name="DC.source" content="index.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Grow Lineages along Minimum Spanning Tree for B Cell Recptor Seqeuence Data</h1><!--introduction--><p>This page provides some examples of using source code version of GLaMST.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Prepare environment</a></li><li><a href="#2">Simulate data</a></li><li><a href="#3">Run GLaMST and visualize the results</a></li><li><a href="#4">Generate lineage tree from real data</a></li></ul></div><h2 id="1">Prepare environment</h2><p>Set working directory to the upzipped folder. If your matlab does not have C/C++ compiler setup, need to first install MinGW, instructions at following link (Home-&gt;Add-Ons-&gt;search MinGW-&gt;install) <a href="https://www.mathworks.com/help/matlab/matlab_external/install-mingw-support-package.html">https://www.mathworks.com/help/matlab/matlab_external/install-mingw-support-package.html</a></p><pre class="codeinput">restoredefaultpath;
addpath <span class="string">lib</span>
addpath <span class="string">src</span>
mex <span class="string">src/editDist_only.cpp</span>
mex <span class="string">src/backtrace.cpp</span>
</pre><pre class="codeoutput">Building with 'Microsoft Visual C++ 2013 Professional'.
MEX completed successfully.
Building with 'Microsoft Visual C++ 2013 Professional'.
MEX completed successfully.
</pre><h2 id="2">Simulate data</h2><p>Simulate a dataset that</p><pre class="codeinput">operation_probability = [0.99 0.005 0.005];<span class="comment">% mutation, insertion, deletion chance</span>
sequence_length = 300; <span class="comment">% Length of the seqeunces</span>
num_tree_nodes = 200; <span class="comment">% Total number of the real tree</span>
sample_size = 100; <span class="comment">% Number of observed nodes</span>
rng(42); <span class="comment">%% Fix the random seed;</span>
[observed_sequences, true_sequences, adj, is_selected] = simulate_data_v2(<span class="keyword">...</span>
    sequence_length,num_tree_nodes,sample_size,operation_probability);
draw_hierarchy_tree(adj, is_selected');
</pre><pre class="codeoutput">Simulation:
    simulate a tree with 200 nodes, and 101 observed sequences (include root) ....   200
    obtained tree size: 144 nodes, 101 observed sequences.
</pre><img vspace="5" hspace="5" src="index_01.png" alt=""> <h2 id="3">Run GLaMST and visualize the results</h2><p>This section is a example of using GLaMST. You need to pass a variable "observed_sequences" that contain a cell array of known sequences to function "reconstruct_tree_minimun_tree_size".  Make sure the first sequence of "observed_sequences" should be root(G.L.).  "reconstructed_nodes" is a cell array of sequences of the reconstructed tree. "reconstructed_is_selected" is the index of tree nodes that known before the reconstruction. "reconstructed_directed_adj" is the adjecent matrix that represent the hierarchical structure of the tree.</p><pre class="codeinput">[reconstructed_nodes,mst_adj,reconstructed_is_selected, reconstructed_directed_adj] = <span class="keyword">...</span>
    reconstruct_tree_minimun_tree_size(observed_sequences);
draw_hierarchy_tree(reconstructed_directed_adj, reconstructed_is_selected);
</pre><pre class="codeoutput">Reconstruction:
    Initialization compute pairwise edit distance:   100 /   101Elapsed time is 1.944908 seconds.
    Iteratived build the tree:     1 /   100    Iteratived build the tree:     2 /   100Elapsed time is 0.122880 seconds.
    Iteratived build the tree:     3 /    99Elapsed time is 0.065291 seconds.
    Iteratived build the tree:     4 /    98Elapsed time is 0.061145 seconds.
    Iteratived build the tree:     5 /    98Elapsed time is 0.097610 seconds.
    Iteratived build the tree:     6 /    97Elapsed time is 0.061575 seconds.
    ......
    Iteratived build the tree:   141 /     2Elapsed time is 0.006475 seconds.
    Iteratived build the tree:   142 /     1Elapsed time is 0.005673 seconds.
    Iteratived build the tree:   143 /     0Elapsed time is 0.003512 seconds.
    Trim the tree for un-necessary nodes ... 
    Rewire the tree to further reduce size ... 143 
</pre><img vspace="5" hspace="5" src="index_02.png" alt=""> <h2 id="4">Generate lineage tree from real data</h2><p>Given this data is not yet publicly avaliable, we have simulated a dataset that has exactly the same topology as used in our paper ( with sequences order shuffled and nucleobase exchenged). This simulated data is avaliable here <a href="https://github.com/xysheep/GLaMST/blob/master/demodata">https://github.com/xysheep/GLaMST/blob/master/demodata</a>.</p><pre class="codeinput">fsa = fastaread(<span class="string">'demodata/real.fasta'</span>);
observed_sequences = {fsa.Sequence}';

[reconstructed_nodes,mst_adj,reconstructed_is_selected, reconstructed_directed_adj] = <span class="keyword">...</span>
    reconstruct_tree_minimun_tree_size(observed_sequences);
draw_hierarchy_tree(reconstructed_directed_adj, reconstructed_is_selected);
</pre><pre class="codeoutput">Reconstruction:
    Initialization compute pairwise edit distance:   541 /   542Elapsed time is 42.614710 seconds.
    Iteratived build the tree:     1 /   541    Iteratived build the tree:     2 /   541Elapsed time is 1.257989 seconds.
    Iteratived build the tree:     3 /   541Elapsed time is 1.303419 seconds.
    Iteratived build the tree:     4 /   541Elapsed time is 1.212983 seconds.
    Iteratived build the tree:     5 /   541Elapsed time is 1.208741 seconds.
    Iteratived build the tree:     6 /   541Elapsed time is 1.233536 seconds.
    Iteratived build the tree:     7 /   541Elapsed time is 1.191659 seconds.
    Iteratived build the tree:     8 /   541Elapsed time is 1.195771 seconds.
    ......
    Iteratived build the tree:  1823 /     5Elapsed time is 0.110148 seconds.
    Iteratived build the tree:  1824 /     4Elapsed time is 0.110480 seconds.
    Iteratived build the tree:  1825 /     3Elapsed time is 0.117508 seconds.
    Iteratived build the tree:  1826 /     2Elapsed time is 0.129545 seconds.
    Iteratived build the tree:  1827 /     1Elapsed time is 0.107900 seconds.
    Iteratived build the tree:  1828 /     1Elapsed time is 0.700191 seconds.
    Iteratived build the tree:  1829 /     0Elapsed time is 0.122778 seconds.
    Trim the tree for un-necessary nodes ... 
    Rewire the tree to further reduce size ... 1192 
    Rewire the tree to further reduce size ... 1191   Elapsed time is 7.799285 seconds.
    Rewire the tree to further reduce size ... 1190   Elapsed time is 4.242021 seconds.
    Rewire the tree to further reduce size ... 1190   Elapsed time is 4.248689 seconds.
    Rewire the tree to further reduce size ... 1190   Elapsed time is 4.290912 seconds.
</pre><img vspace="5" hspace="5" src="index_03.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Grow Lineages along Minimum Spanning Tree for B Cell Recptor Seqeuence Data
% This page provides some examples of using source code version of GLaMST.


%% Prepare environment
% Set working directory to the upzipped folder. If your matlab does not have
% C/C++ compiler setup, need to first install MinGW, instructions at 
% following link (Home->Add-Ons->search MinGW->install) 
% <https://www.mathworks.com/help/matlab/matlab_external/install-mingw-support-package.html>

restoredefaultpath;
addpath lib
addpath src
mex src/editDist_only.cpp
mex src/backtrace.cpp


%% Simulate data
% Simulate a dataset that 
operation_probability = [0.99 0.005 0.005];% mutation, insertion, deletion chance
sequence_length = 300; % Length of the seqeunces
num_tree_nodes = 200; % Total number of the real tree
sample_size = 100; % Number of observed nodes
rng(42); %% Fix the random seed;
[observed_sequences, true_sequences, adj, is_selected] = simulate_data_v2(...
    sequence_length,num_tree_nodes,sample_size,operation_probability);
draw_hierarchy_tree(adj, is_selected');

%% Run GLaMST and visualize the results
% This section is a example of using GLaMST. You need to pass a variable
% "observed_sequences" that contain a cell array of known sequences to
% function "reconstruct_tree_minimun_tree_size". ** Make sure the first
% sequence of "observed_sequences" should be root(G.L.). **
% "reconstructed_nodes" is a cell array of sequences of the reconstructed
% tree. "reconstructed_is_selected" is the index of tree nodes that known
% before the reconstruction. "reconstructed_directed_adj" is the adjecent
% matrix that represent the hierarchical structure of the tree.
[reconstructed_nodes,mst_adj,reconstructed_is_selected, reconstructed_directed_adj] = ...
    reconstruct_tree_minimun_tree_size(observed_sequences);
draw_hierarchy_tree(reconstructed_directed_adj, reconstructed_is_selected);


%% Generate lineage tree from real data
% Given this data is not yet publicly avaliable, we have simulated a
% dataset that has exactly the same topology as used in our paper ( with
% sequences order shuffled and nucleobase exchenged). This simulated data
% is avaliable here
% <https://github.com/xysheep/GLaMST/blob/master/demodata>.
fsa = fastaread('demodata/real.fasta');
observed_sequences = {fsa.Sequence}';

[reconstructed_nodes,mst_adj,reconstructed_is_selected, reconstructed_directed_adj] = ...
    reconstruct_tree_minimun_tree_size(observed_sequences);
draw_hierarchy_tree(reconstructed_directed_adj, reconstructed_is_selected);

##### SOURCE END #####
--></body></html>